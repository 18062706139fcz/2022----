# HTTP的报文是什么样子的

### HTTP 协议的请求报文和响应报文的结构基本相同，由三大部分组成：
```
1.起始行（start line）：描述请求或响应的基本信息；
2.头部字段集合（header）：使用 key-value 形式更详细地说明报文；
3.消息正文（entity）：实际传输的数据，它不一定是纯文本，可以是图片、视频等二进制数据。
```
> HTTP报文如图<br>

![image](https://static001.geekbang.org/resource/image/62/3c/62e061618977565c22c2cf09930e1d3c.png)

```
1.起始行由三部分构成：
（1）请求方法：是一个动词，如 GET/POST，表示对资源的操作；
（2）请求目标：通常是一个 URI，标记了请求方法要操作的资源；
（3）版本号：表示报文使用的 HTTP 协议版本。
```
![image](https://static001.geekbang.org/resource/image/36/b9/36108959084392065f36dff3e12967b9.png)


```
1.状态行由三部分构成：「与起始行对应，不过不叫响应行」
（1）版本号：表示报文使用的 HTTP 协议版本；
（2）状态码：一个三位数，用代码的形式表示处理的结果，比如 200 是成功，500 是服务器错误；
（3）原因：作为数字状态码补充，是更详细的解释文字，帮助人理解原因。
```

头部字段请求报文和响应报文差不多
![image](https://static001.geekbang.org/resource/image/1f/ea/1fe4c1121c50abcf571cebd677a8bdea.png)<br>

![image](https://static001.geekbang.org/resource/image/cb/75/cb0d1d2c56400fe9c9988ee32842b175.png)
```
使用头字段的注意点：
1.字段名不区分大小写，例如“Host”也可以写成“host”，但首字母大写的可读性更好；
2.字段名里不允许出现空格，可以使用连字符“-”，但不能使用下划线“_”。例如，“test-name”是合法的字段名，而“test name”“test_name”是不正确的字段名；
3.字段名后面必须紧接着“:”，不能有空格，而“:”后的字段值前可以有多个空格；
4.字段的顺序是没有意义的，可以任意排列不影响语义；
5.字段原则上不能重复，除非这个字段本身的语义允许，例如 Set-Cookie。
```

### 常用头字段
```
四大类头字段
（1）通用字段：在请求头和响应头里都可以出现；
（2）请求字段：仅能出现在请求头里，进一步说明请求信息或者额外的附加条件；
（3）响应字段：仅能出现在响应头里，补充说明响应报文的信息；
（4）实体字段：它实际上属于通用字段，但专门描述 body 的额外信息。
```

### 总结
```
1.HTTP 报文结构就像是“大头儿子”，由“起始行 + 头部 + 空行 + 实体”组成，简单地说就是“header+body”；
2.HTTP 报文可以没有 body，但必须要有 header，而且 header 后也必须要有空行，形象地说就是“大头”必须要带着“脖子”；
3.请求头由“请求行 + 头部字段”构成，响应头由“状态行 + 头部字段”构成；请求行有三部分：请求方法，请求目标和版本号；
4.状态行也有三部分：版本号，状态码和原因字符串；头部字段是 key-value 的形式，用“:”分隔，不区分大小写，顺序任意，除了规定的标准头，也可以任意添加自定义字段，实现功能扩展；
5.HTTP/1.1 里唯一要求必须提供的头字段是 Host，它必须出现在请求头里，标记虚拟主机名。
```

## 应该如何理解请求方法

> 请求头里的请求方法

```
请求方法：客户端发出了一个“动作指令”，要求服务器端对 URI 定位的资源执行这个动作。
八种常见方法，单词都必须是大写的形式
1.GET:获取资源，可以理解为读取或者下载数据；
2.HEAD:获取资源的元信息；
//HEAD 方法与 GET 方法类似，也是请求从服务器获取资源，服务器的处理机制也是一样的，但服务器不会返回请求的实体数据，只会传回响应头，也就是资源的“元信息”。
3.POST：向资源提交数据，相当于写入或上传数据；
4.PUT：类似 POST；
5.DELETE：删除资源；
6.CONNECT：建立特殊的连接隧道；
7.OPTIONS：列出可对资源实行的方法；
8.TRACE：追踪请求 - 响应的传输路径。
```
![image](https://static001.geekbang.org/resource/image/3c/6d/3cdc8ac71b80929f4a94dfeb9ffe4b6d.jpg)

## 安全与幂等
```
1.安全：请求方法不会“破坏”服务器上的资源，即不会对服务器上的资源造成实质的修改。
2.“幂等”实际上是一个数学用语，被借用到了 HTTP 协议里，意思是多次执行相同的操作，结果也都是相同的，即多次“幂”后结果“相等”。
GET和HEAD是安全的，因为只读取取不修改，GET和HEAD也是幂等的，因为多次执行GET和HEAD操作后，结果是相同的
POST/PUT/DELETE都是不安全的
POST 和 PUT 的幂等性质：
POST 是“新增或提交数据”，多次提交数据会创建多个资源，所以不是幂等的；而 PUT 是“替换或更新数据”，多次更新一个资源，资源还是会第一次更新的状态，所以是幂等的。
```

## 小结：
```
请求方法是客户端发出的、要求服务器执行的、对资源的一种操作；
请求方法是对服务器的“指示”，真正应如何处理由服务器来决定；
最常用的请求方法是 GET 和 POST，分别是获取数据和发送数据；
HEAD 方法是轻量级的 GET，用来获取资源的元信息；
PUT 基本上是 POST 的同义词，多用于更新数据；
“安全”与“幂等”是描述请求方法的两个重要属性，具有理论指导意义，可以帮助我们设计系统。
```

## URI相关知识
```
1.URI 是用来唯一标记服务器上资源的一个字符串，通常也称为 URL；
2.URI 通常由 scheme、host:port、path 和 query 四个部分组成，有的可以省略；
3.scheme 叫“方案名”或者“协议名”，表示资源应该使用哪种协议来访问；
4.“host:port”表示资源所在的主机名和端口号；path 标记资源所在的位置；
5.query 表示对资源附加的额外要求；
6.在 URI 里对“@&/”等特殊字符和汉字必须要做编码，否则服务器收到 HTTP 报文后会无法正确处理。
```

## 状态码相关知识
```
1.状态码在响应报文里表示了服务器对请求的处理结果；
2.状态码后的原因短语是简单的文字描述，可以自定义；
3.状态码是十进制的三位数，分为五类，从 100 到 599；
4.2××类状态码表示成功，常用的有 200、204、206；
5.3××类状态码表示重定向，常用的有 301、302、304；
6.4××类状态码表示客户端错误，常用的有 400、403、404；
7.5××类状态码表示服务器错误，常用的有 500、501、502、503。
```

## HTTP有哪些特点
```
1.HTTP 是灵活可扩展的，可以任意添加头字段实现任意功能；
2.HTTP 是可靠传输协议，基于 TCP/IP 协议“尽量”保证数据的送达；
3.HTTP 是应用层协议，比 FTP、SSH 等更通用功能更多，能够传输任意数据；
4.HTTP 使用了请求 - 应答模式，客户端主动发起请求，服务器被动回复请求；
5.HTTP 本质上是无状态的，每个请求都是互相独立、毫无关联的，协议不要求客户端或服务器记录请求相关的信息。
```

## HTTP的优点与缺点

> 1.HTTP 最大的优点是简单、灵活和易于扩展；<br>
> 2.HTTP 拥有成熟的软硬件环境，应用的非常广泛，是互联网的基础设施；<br>
```
它并不限定某种编程语言或者操作系统，所以天然具有“跨语言、跨平台”的优越性。
```
> 3.HTTP 是无状态的，可以轻松实现集群化，扩展性能，但有时也需要用 Cookie 技术来实现“有状态”；<br>
```
因为服务器没有“记忆能力”，所以就不需要额外的资源来记录状态信息，
不仅实现上会简单一些，而且还能减轻服务器的负担，能够把更多的 CPU 和内存用来对外提供服务。
而且，“无状态”也表示服务器都是相同的，没有“状态”的差异，所以可以很容易地组成集群，让负载均衡把请求转发到任意一台服务器，
不会因为状态不一致导致处理出错，使用“堆机器”的“笨办法”轻松实现高并发高可用。
```
> 4.HTTP 是明文传输，数据完全肉眼可见，能够方便地研究分析，但也容易被窃听；<br>
> 5.HTTP 是不安全的，无法验证通信双方的身份，也不能判断报文是否被篡改；<br>
```
HTTP不安全的三个方面：
(1)数据被窃听
(2)身份被冒用
(3)数据被篡改
```
> 6.HTTP 的性能不算差，但不完全适应现在的互联网，还有很大的提升空间。<br>
